

# Pentest Technique

## 偵察

### 共通

#### 通信相手のOSを知る
- **コマンド:**  
  `ping -c 1 <IP>`  
  **ttlの時間で判別する:**  
  - `ttl=64`  
    - Linux OS/Mac OS  
  - `ttl=128`  
    - Windows OS  
  - `ttl=255`  
    - UNIX OS/ネットワーク機器  

#### ポートスキャン
- **コマンド:**  
  `sudo nmap -vvv -sCV -T4 -p0-65535 -Pn <IP>`

---

### ポート80、8080が空いていた場合

#### CMS、JavaScriptライブラリ、ウェブサーバ、バージョン番号、ウェブフレームワークの取得
- **コマンド:**  
  `sudo whatweb <http://IP>`

#### Webサーバ上のディレクトリ列挙
- **コマンド:**  
  `gobuster dir -u <http://IP> -w /usr/share/wordlists/dirb/common.txt`  
  **ワードファイル候補:**  
  - `/usr/share/wordlists/dirb/big.txt`

#### サブドメインの列挙
- **コマンド:**  
  `gobuster dns -d <http://IP> -w /usr/share/wordlists/subdomains.txt`

#### VHOST（仮想ホスト）の列挙
- **コマンド:**  
  `gobuster vhost -u <http://IP> -w /usr/share/wordlists/vhosts.txt`

#### サイト脆弱性スキャン
- **コマンド:**  
  `nikto -h <http://IP>`

---

### ポート21が空いていた場合

#### FTP Anonymous Access
- **確認方法:**  
  `ftp <IP>`  
  - **ユーザー名:** `anonymous` または `ftp`  
  - **パスワード:** 空欄でEnter

---

## Webサイト情報取得

- **Burpsuite:**  
  Webブラウザで確認するなら、Burpsuiteのブラウザを使用する。  
- **コマンドライン:**  
  mdファイルなどはブラウザよりも`curl`コマンドで確認すると見やすい。
  - **コマンド:**  
    `curl -k <URL>`  
    (*`-k`でエラーを無視可能*)

---

## 脆弱性調査

- HTBやOSCPでは、**XSS (Cross Site Script)** の脆弱性は使用しない。  
  - **理由:** XSSは他のユーザーが引っかかる必要があるが、OSCPやHTBではそのような環境が存在しない。

---

## シェルアップデート

- **コマンド:**  
  `python -c 'import pty; pty.spawn("/bin/bash")'`

---

## Windows版

### TCPポート 445・TCP/UDPポート 139が空いている場合

#### SMBの脆弱性スキャン
- **コマンド:**  
  `nmap --script=smb-vuln* <IP>`

#### Sambaを介して共有情報を取得する
- **ツール:**  
  `enum4linux`  
  **取得可能な情報:**  
  - グループメンバーシップ情報  
  - 共有情報  
  - ワークグループまたはドメインメンバーシップ  
  - リモートオペレーティングシステムの識別  
  - パスワードポリシー  
